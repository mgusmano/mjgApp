(function(d,f){$.Flips=function(b,a){this.$el=$(a);this._init(b)};$.Flips.defaults={flipspeed:900,fliptimingfunction:"linear",current:0};$.Flips.prototype={_init:function(a){this.options=$.extend(true,{},$.Flips.defaults,a);this.$pages=this.$el.children("div.f-page");this.pagesCount=this.$pages.length;this.currentPage=this.options.current;this._validateOpts();this._getWinSize();this._getState();this._layout();this._initTouchSwipe();this._loadEvents();this._goto()},_validateOpts:function(){if(this.currentPage<0||this.currentPage>this.pagesCount){this.currentPage=0}},_getWinSize:function(){var a=$(d);this.windowProp={width:a.width(),height:a.height()}},_goto:function(){var a=(this.state===f)?this.currentPage:this.state;if(!this._isNumber(a)||a<0||a>this.flipPagesCount){a=0}this.currentPage=a},_getState:function(){this.state=0},_isNumber:function(a){return parseFloat(a)==parseInt(a)&&!isNaN(a)&&isFinite(a)},_adjustLayout:function(a){var b=this;this.$flipPages.each(function(c){var h=$(this);if(c===a-1){h.css({"-webkit-transform":"rotateY( -180deg )","-moz-transform":"rotateY( -180deg )","z-index":b.flipPagesCount-1+c})}else{if(c<a){h.css({"-webkit-transform":"rotateY( -181deg )","-moz-transform":"rotateY( -181deg )","z-index":b.flipPagesCount-1+c})}else{h.css({"-webkit-transform":"rotateY( 0deg )","-moz-transform":"rotateY( 0deg )","z-index":b.flipPagesCount-1-c})}}})},_saveState:function(){},_layout:function(){this._setLayoutSize();for(var a=0;a<=this.pagesCount-2;++a){var c=this.$pages.eq(a),b={theClass:"page",theContentFront:c.html(),theContentBack:(a!==this.pagesCount)?this.$pages.eq(a+1).html():"",theStyle:"z-index: "+(this.pagesCount-a)+";left: "+(this.windowProp.width/2)+"px;",theContentStyleFront:"width:"+this.windowProp.width+"px;",theContentStyleBack:"width:"+this.windowProp.width+"px;"};if(a===0){b.theClass+=" cover"}else{b.theContentStyleFront+="left:-"+(this.windowProp.width/2)+"px";if(a===this.pagesCount-2){b.theClass+=" cover-back"}}$("#pageTmpl").tmpl(b).appendTo(this.$el)}this.$pages.remove();this.$flipPages=this.$el.children("div.page");this.flipPagesCount=this.$flipPages.length;this._adjustLayout((this.state===f)?this.currentPage:this.state)},_setLayoutSize:function(){this.$el.css({width:this.windowProp.width,height:this.windowProp.height})},_initTouchSwipe:function(){var a=this;this.$el.swipe({threshold:0,swipeStatus:function(E,I,D,y,b,F){var x=D.x,H=y.x,C,z,A=false,w=false;if(!a._isAnimating()){(x<a.windowProp.width/2)?a.flipSide="l2r":a.flipSide="r2l"}if(b==="up"||b==="down"){if(a.angle===f||a.angle===0){a._removeOverlays();return false}else{(a.angle<90)?b="right":b="left"}}a.flipDirection=b;if(a.currentPage===0&&a.flipSide==="l2r"||a.currentPage===a.flipPagesCount&&a.flipSide==="r2l"){return false}C=a.windowProp.width-x;var c=0.9*(a.windowProp.width/2);if(Math.abs(x-C)<c){(a.flipSide==="r2l")?C-=c/2:C+=c/2}if(H>x&&a.flipSide==="r2l"){z=0;A=true;w=true}else{if(H<C&&a.flipSide==="r2l"){z=180;A=true}else{if(H>C&&a.flipSide==="l2r"){z=0;A=true}else{if(H<x&&a.flipSide==="l2r"){z=180;A=true;w=true}else{var G,s,B;(a.flipSide==="r2l")?(G=x,s=C,B=x-F):(G=C,s=x,B=x+F);z=a._calcAngle(B,G,s);if((b==="left"&&a.flipSide==="l2r")||(b==="right"&&a.flipSide==="r2l")){w=true}}}}}switch(I){case"start":if(a._isAnimating()){a.start=true;return false}else{a.start=false}a._setFlippingPage();a.$beforePage=a.$flippingPage.prev();a.$afterPage=a.$flippingPage.next();break;case"move":if(F>0){if(a._isAnimating()||a.start){return false}if(!a.hasOverlays){a._addOverlays()}a.angle=z;a._turnPage(z,true)}break;case"end":if(F>0){if(a._isAnimating()||a.start){return false}a.isAnimating=true;(w)?a.$flippingPage.data("flip",false):a.$flippingPage.data("flip",true);if(A){if(!w){a._updatePage()}a._onEndFlip(a.$flippingPage)}else{a.angle=z;a._calculateSpeed();switch(b){case"left":a._turnPage(180);if(a.flipSide==="r2l"){a._updatePage()}break;case"right":a._turnPage(0);if(a.flipSide==="l2r"){a._updatePage()}break}}}break}}})},_setFlippingPage:function(){var a=this;(this.flipSide==="l2r")?this.$flippingPage=this.$flipPages.eq(this.currentPage-1):this.$flippingPage=this.$flipPages.eq(this.currentPage);this.$flippingPage.on("webkitTransitionEnd.flips transitionend.flips OTransitionEnd.flips",function(b){if($(b.target).hasClass("page")){a._onEndFlip($(this))}})},_updatePage:function(){if(this.flipSide==="r2l"){++this.currentPage}else{if(this.flipSide==="l2r"){--this.currentPage}}},_isAnimating:function(){if(this.isAnimating){return true}return false},_loadEvents:function(){var a=this;$(d).on("resize.flips",function(b){a._getWinSize();a._setLayoutSize();var c=a.$flipPages.children("div.front").find("div.content"),h=a.$flipPages.children("div.back").find("div.content");a.$flipPages.css("left",a.windowProp.width/2);c.filter(function(g){return g>0}).css({width:a.windowProp.width,left:-a.windowProp.width/2});c.eq(0).css("width",a.windowProp.width);h.css("width",a.windowProp.width)});$(d).on("statechange.flips",function(b){a._getState();a._goto();if(!a.isAnimating){a._adjustLayout(a.currentPage)}});this.$flipPages.find(".box").on("click.flips",function(l){var c=$(this),m=$('<span class="box-close">close</span>'),o={speed:450,timingfunction:"linear"},p=$('<div class="overlay">close</div>').css({"z-index":9998,"-webkit-transition":"opacity "+o.speed+"ms "+o.timingfunction,"-moz-transition":"opacity "+o.speed+"ms "+o.timingfunction}).prependTo($("body")),b={width:c.outerWidth(true),height:c.outerHeight(true),left:c.offset().left,top:c.offset().top},n=c.clone().css({position:"absolute",width:b.width,height:b.height,left:b.left,top:b.top,zIndex:9999,"overflow-y":"auto","-webkit-transition":"all "+o.speed+"ms "+o.timingfunction,"-moz-transition":"all "+o.speed+"ms "+o.timingfunction}).insertAfter(p).end().append(m.on("click.flips",function(g){p.css("opacity",0);n.children().hide().end().removeClass("box-expanded").css({width:a.windowProp.width,height:a.windowProp.height,"overflow-y":"hidden"});setTimeout(function(){n.css({left:b.left,top:b.top,width:b.width,height:b.height,"-webkit-transition":"all "+o.speed+"ms "+o.timingfunction,"-moz-transition":"all "+o.speed+"ms "+o.timingfunction})},0)})).children().hide().end().on("webkitTransitionEnd.flips transitionend.flips OTransitionEnd.flips",function(g){if($(g.target).hasClass("box-expanded")){$(this).css({width:"100%",height:"100%","-webkit-transition":"none","-moz-transition":"none"}).children().fadeIn()}else{p.remove();$(this).remove()}});setTimeout(function(){p.css({opacity:1});n.addClass("box-expanded").css({left:0,top:0,width:a.windowProp.width,height:a.windowProp.height})},0)})},_onEndFlip:function(a){if((this.flipSide==="l2r"&&a.data("flip"))||(this.flipSide==="r2l"&&!a.data("flip"))){a.css("z-index",this.pagesCount-2-a.index())}this.$flippingPage.css({"-webkit-transition":"none","-moz-transition":"none"});this._removeOverlays();this._saveState();this.isAnimating=false;if(this.flipSide==="r2l"||(this.flipSide==="l2r"&&!a.data("flip"))){this.$flippingPage.find(".back").css("-webkit-transform","rotateY(-180deg)")}},_calcAngle:function(c,b,a){return(-180/(b-a))*c+((b*180)/(b-a))},_calculateSpeed:function(){(this.flipDirection==="right")?this.flipSpeed=(this.options.flipspeed/180)*this.angle:this.flipSpeed=-(this.options.flipspeed/180)*this.angle+this.options.flipspeed},_turnPage:function(b,a){this.$beforePage.css({"-webkit-transform":"rotateY( -180deg )","-moz-transform":"rotateY( -180deg )"});if(!a){this.$flippingPage.css({"-webkit-transition":"-webkit-transform "+this.flipSpeed+"ms "+this.options.fliptimingfunction,"-moz-transition":"-moz-transform "+this.flipSpeed+"ms "+this.options.fliptimingfunction})}var c=(this.flipSide==="r2l")?this.currentPage:this.currentPage-1;if(this.flipSide==="r2l"){this.$flippingPage.css("z-index",this.flipPagesCount-1+c)}this.$flippingPage.find(".back").css("-webkit-transform","rotateY(180deg)");this.$flippingPage.css({"-webkit-transform":"rotateY(-"+b+"deg)","-moz-transform":"rotateY(-"+b+"deg)"});this._overlay(b,a)},_addOverlays:function(){var a=this;this._removeOverlays();this.hasOverlays=true;this.$frontoverlay=$('<div class="flipoverlay"></div>').appendTo(this.$flippingPage.find("div.front > .outer"));this.$backoverlay=$('<div class="flipoverlay"></div>').appendTo(this.$flippingPage.find("div.back > .outer"));if(this.$afterPage){this.$afterOverlay=$('<div class="overlay"></div>').appendTo(this.$afterPage.find("div.front > .outer"))}if(this.$beforePage){this.$beforeOverlay=$('<div class="overlay"></div>').appendTo(this.$beforePage.find("div.back > .outer"))}},_removeOverlays:function(){if(this.$frontoverlay){this.$frontoverlay.remove()}if(this.$backoverlay){this.$backoverlay.remove()}if(this.$afterOverlay){this.$afterOverlay.remove()}if(this.$beforeOverlay){this.$beforeOverlay.remove()}this.hasOverlays=false},_overlay:function(p,c){if(c){var u=-(1/90)*p+1,b=(1/90)*p-1;if(this.$afterOverlay){this.$afterOverlay.css("opacity",u)}if(this.$beforeOverlay){this.$beforeOverlay.css("opacity",b)}var s=0.1;this.$frontoverlay.css("opacity",s);this.$backoverlay.css("opacity",s)}else{var a=this;var t=this.flipSpeed,v=this.flipSpeed,o=60;if(this.$afterOverlay){var q=0;if(this.flipDirection==="right"){if(this.angle>90){q=Math.abs(this.flipSpeed-this.options.flipspeed/2-o);t=this.options.flipspeed/2-o}else{t-=o}}else{t=Math.abs(this.flipSpeed-this.options.flipspeed/2)}if(t<=0){t=1}this.$afterOverlay.css({"-webkit-transition":"opacity "+t+"ms "+this.options.fliptimingfunction+" "+q+"ms","-moz-transition":"opacity "+t+"ms "+this.options.fliptimingfunction+" "+q+"ms",opacity:(this.flipDirection==="left")?0:1}).on("webkitTransitionEnd.flips transitionend.flips OTransitionEnd.flips",function(g){if(a.$beforeOverlay){a.$beforeOverlay.off("webkitTransitionEnd.flips transitionend.flips OTransitionEnd.flips")}setTimeout(function(){a._adjustLayout(a.currentPage)},a.options.flipspeed/2-o)})}if(this.$beforeOverlay){var r=0;if(this.flipDirection==="left"){if(this.angle<90){r=Math.abs(this.flipSpeed-this.options.flipspeed/2-o);v=this.options.flipspeed/2-o}else{v-=o}}else{v=Math.abs(this.flipSpeed-this.options.flipspeed/2)}if(v<=0){v=1}this.$beforeOverlay.css({"-webkit-transition":"opacity "+v+"ms "+this.options.fliptimingfunction+" "+r+"ms","-moz-transition":"opacity "+v+"ms "+this.options.fliptimingfunction+" "+r+"ms",opacity:(this.flipDirection==="left")?1:0}).on("webkitTransitionEnd.flips transitionend.flips OTransitionEnd.flips",function(g){if(a.$afterOverlay){a.$afterOverlay.off("webkitTransitionEnd.flips transitionend.flips OTransitionEnd.flips")}a._adjustLayout(a.currentPage)})}}}};var e=function(a){if(this.console){console.error(a)}};$.fn.flips=function(a){if(typeof a==="string"){var b=Array.prototype.slice.call(arguments,1);this.each(function(){var c=$.data(this,"flips");if(!c){e("cannot call methods on flips prior to initialization; attempted to call method '"+a+"'");return}if(!$.isFunction(c[a])||a.charAt(0)==="_"){e("no such method '"+a+"' for flips instance");return}c[a].apply(c,b)})}else{this.each(function(){var c=$.data(this,"flips");if(!c){$.data(this,"flips",new $.Flips(a,this))}})}return this}})(window);